## Contributing

Feel free to submit pull requests. You will be credited with your contributions.

## Adding or fixing Javascript syntax

The process of adding or fixing Javascript parsing/instrumenting issues is quite straightforward. Qoverage iterates through the JS AST generated by `qmldom`. To generate correct instrumentation, it usually only needs to know for each AST node:

* How to get the start offset (in characters from file start)? This is the point just before the statement/expression starts.
* Likewise for the end offset. Note that for many nodes, the end is actually determined by a child node (such as "a && b", which is a BinaryExpression but to find its end you need to find the end of the "b" node).
* Whether, if found in a statement list, this node would potentially end linear code execution. Examples: if, while, for, break, continue, yield, ...
* Whether the node has any children that should also be visited. By default, if the start and end are known, children are skipped. Nodes with relevant children are e.g.: if/else, for, while, try, ...

The ways to tell the above properties for each node are defined in the [dom.py](qoverage/dom.py) file. All node types given by `qmldom` are already listed there, some are just commented out.

## Adding/changing Javascript analysis and testing

To add/change a behavior:

* First, add a testcase inside `test/examples`. You can copy the `basic` example. Don't worry about the `//COV:xxx` comments for now.
* In the new testcase (make sure it has a `main.qml`), write an example of the buggy/unsupported syntax.
* Run the testcase: `OPEN_DIFF_TOOL=kdiff3 pytest test -k 'test_example[my_testcase]'`. This will run only your case. If it finishes, it will open `kdiff3` (or whatever tool you put there, should support directory diff) to show you the difference between the `//COV:xxx` annotation in the testcase and the actual coverage found. If the testcase didn't finish at all, have a look at the instrumented sources to see whether instrumentation made the file invalid.
* Use the result to make any fixes necessary to `qoverage`, and when the outcome looks correct, copy the `//COV:xxx` annotations into the testcase. The test should now pass.
