From a601cf28386cb0592f2b8c23eebd508ca3821264 Mon Sep 17 00:00:00 2001
From: Sander Vocke <sandervocke@gmail.com>
Date: Tue, 5 Sep 2023 09:22:23 +0000
Subject: [PATCH] Fix duplicate memcpy

---
 libc-top-half/musl/include/sched.h            |  3 +--
 ...c.0001-Fix-getpid.c-path-in-Makefile.patch | 25 +++++++++++++++++++
 2 files changed, 26 insertions(+), 2 deletions(-)
 create mode 100644 wasix-libc.0001-Fix-getpid.c-path-in-Makefile.patch

diff --git a/libc-top-half/musl/include/sched.h b/libc-top-half/musl/include/sched.h
index 3d3fbe8..c5f25b1 100644
--- a/libc-top-half/musl/include/sched.h
+++ b/libc-top-half/musl/include/sched.h
@@ -5,6 +5,7 @@ extern "C" {
 #endif
 
 #include <features.h>
+#include <__functions_memcpy.h>
 
 #define __NEED_struct_timespec
 #define __NEED_pid_t
@@ -81,9 +82,7 @@ int clone (int (*)(void *), void *, int, void *, ...);
 int unshare(int);
 int setns(int, int);
 
-void *memcpy(void *__restrict, const void *__restrict, size_t);
 int memcmp(const void *, const void *, size_t);
-void *memset (void *, int, size_t);
 void *calloc(size_t, size_t);
 void free(void *);
 
diff --git a/wasix-libc.0001-Fix-getpid.c-path-in-Makefile.patch b/wasix-libc.0001-Fix-getpid.c-path-in-Makefile.patch
new file mode 100644
index 0000000..9bf2354
--- /dev/null
+++ b/wasix-libc.0001-Fix-getpid.c-path-in-Makefile.patch
@@ -0,0 +1,25 @@
+From 1bed7fd04e44943511e50d82c59ca182d2532af1 Mon Sep 17 00:00:00 2001
+From: Sander Vocke <sandervocke@gmail.com>
+Date: Tue, 5 Sep 2023 06:32:01 +0000
+Subject: [PATCH] Fix getpid.c path in Makefile
+
+---
+ Makefile | 2 +-
+ 1 file changed, 1 insertion(+), 1 deletion(-)
+
+diff --git a/Makefile b/Makefile
+index a424ef7..d9ef327 100644
+--- a/Makefile
++++ b/Makefile
+@@ -69,7 +69,7 @@ LIBWASI_EMULATED_MMAN_SOURCES = \
+ LIBWASI_EMULATED_PROCESS_CLOCKS_SOURCES = \
+     $(sort $(shell find $(LIBC_BOTTOM_HALF_DIR)/clocks -name \*.c))
+ LIBWASI_EMULATED_GETPID_SOURCES = \
+-    $(sort $(shell find $(LIBC_BOTTOM_HALF_DIR)/getpid -name \*.c))
++    $(sort $(shell find $(LIBC_BOTTOM_HALF_DIR)/sources/getpid -name \*.c))
+ LIBWASI_EMULATED_SIGNAL_SOURCES = \
+     $(sort $(shell find $(LIBC_BOTTOM_HALF_DIR)/signal -name \*.c))
+ LIBC_BOTTOM_HALF_CRT_SOURCES = $(wildcard $(LIBC_BOTTOM_HALF_DIR)/crt/*.c)
+-- 
+2.42.0
+
-- 
2.42.0

